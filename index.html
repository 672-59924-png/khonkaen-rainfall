<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ปริมาณน้ำฝน จังหวัดขอนแก่น</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  font-family: system-ui, sans-serif;
  background: #f4f6f8;
  margin: 0;
  padding: 20px;
}
.top {
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: 10px;
}
select {
  padding: 6px;
}
.card {
  background: white;
  padding: 16px;
  border-radius: 10px;
  margin-top: 20px;
}
table {
  width: 100%;
  border-collapse: collapse;
}
th, td {
  padding: 6px;
  border-bottom: 1px solid #ddd;
  text-align: center;
}
th {
  background: #eee;
}
</style>
</head>

<body>

<div class="top">
  <h1 id="title">ปริมาณน้ำฝน จังหวัดขอนแก่น</h1>
  <div>
    <select id="lang" onchange="setLang(this.value)">
      <option value="th">ไทย</option>
      <option value="en">English</option>
      <option value="ja">日本語</option>
      <option value="zh">中文</option>
    </select>

    <select id="range" onchange="render()">
      <option value="7">7 days</option>
      <option value="30" selected>30 days</option>
      <option value="90">90 days</option>
      <option value="150">150 days</option>
      <option value="365">365 days</option>
      <option value="500">500 days</option>
      <option value="730" selected>2 years (730 days)</option>
    </select>

    <select id="mode" onchange="render()">
      <option value="daily">Daily</option>
      <option value="monthly">Monthly</option>
    </select>
  </div>
</div>

<p id="subtitle">ข้อมูลปริมาณน้ำฝนย้อนหลัง</p>

<div class="card">
  <canvas id="chart"></canvas>
</div>

<div class="card">
  <h3>ตารางข้อมูลรายวัน</h3>
  <table>
    <thead>
      <tr>
        <th>วันที่</th>
        <th>ปริมาณฝน (มม.)</th>
      </tr>
    </thead>
    <tbody id="table"></tbody>
  </table>
</div>

<script>
/* ---------- ภาษา ---------- */
const T = {
  th:{title:"ปริมาณน้ำฝน จังหวัดขอนแก่น",sub:"ข้อมูลปริมาณน้ำฝนย้อนหลัง"},
  en:{title:"Rainfall in Khon Kaen",sub:"Historical rainfall data"},
  ja:{title:"コンケン県の降水量",sub:"過去の降水量データ"},
  zh:{title:"孔敬府降雨量",sub:"历史降雨数据"}
};
function setLang(l){
  title.innerText=T[l].title;
  subtitle.innerText=T[l].sub;
}

/* ---------- สร้างข้อมูลรายวันย้อนหลัง 2 ปี (จำลอง) ---------- */
const ALL=[];
const today=new Date();
for(let i=730;i>=0;i--){
  const d=new Date(today);
  d.setDate(d.getDate()-i);
  ALL.push({
    date:d.toISOString().split("T")[0],
    rain:+(Math.random()*40).toFixed(1)
  });
}

let chart;

/* ---------- render ---------- */
function render(){
  const days=+range.value;
  const mode=document.getElementById("mode").value;

  let data=ALL.slice(-days);

  if(mode==="monthly"){
    const map={};
    data.forEach(d=>{
      const m=d.date.slice(0,7);
      map[m]=(map[m]||0)+d.rain;
    });
    data=Object.keys(map).map(k=>({date:k,rain:+map[k].toFixed(1)}));
  }

  // chart
  if(chart) chart.destroy();
  chart=new Chart(document.getElementById("chart"),{
    type:"bar",
    data:{
      labels:data.map(d=>d.date),
      datasets:[{
        label:"mm",
        data:data.map(d=>d.rain)
      }]
    },
    options:{
      responsive:true,
      scales:{y:{beginAtZero:true}}
    }
  });

  // table
  const tb=document.getElementById("table");
  tb.innerHTML="";
  data.forEach(d=>{
    tb.innerHTML+=`<tr><td>${d.date}</td><td>${d.rain}</td></tr>`;
  });
}

render();
</script>

</body>
</html>
