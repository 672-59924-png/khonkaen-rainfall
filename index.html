<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Khon Kaen Rainfall</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{font-family:system-ui;background:#f4f6f8;margin:0;padding:20px}
.top{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px}
.card{background:#fff;padding:16px;border-radius:12px;margin-top:20px}
.stats{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.stat{background:#eee;padding:12px;border-radius:10px;text-align:center}
table{width:100%;border-collapse:collapse}
th,td{padding:6px;border-bottom:1px solid #ddd;text-align:center}
th{background:#eee}
select,button{padding:6px}
</style>
</head>

<body>

<div class="top">
  <h1 id="title">ปริมาณน้ำฝน จังหวัดขอนแก่น</h1>
  <div>
    <select id="lang" onchange="setLang(this.value)">
      <option value="th">TH</option>
      <option value="en">EN</option>
    </select>

    <select id="range" onchange="render()">
      <option value="7">7</option>
      <option value="30">30</option>
      <option value="90">90</option>
      <option value="120">120</option>
      <option value="150">150</option>
      <option value="365">365</option>
      <option value="500">500</option>
      <option value="730" selected>730</option>
    </select>

    <select id="mode" onchange="render()">
      <option value="daily">Daily</option>
      <option value="monthly">Monthly</option>
    </select>
  </div>
</div>

<p id="subtitle">
ข้อมูลปริมาณน้ำฝนย้อนหลัง (อ้างอิงสถานีอุตุนิยมวิทยาขอนแก่น)
</p>

<div class="stats">
  <div class="stat"><div id="sum">0</div><small id="tSum">ฝนรวม</small></div>
  <div class="stat"><div id="avg">0</div><small id="tAvg">เฉลี่ย/วัน</small></div>
  <div class="stat"><div id="max">0</div><small id="tMax">มากสุด</small></div>
</div>

<div class="card">
  <canvas id="chart"></canvas>
</div>

<div class="card">
  <h3 id="tableTitle">ตารางข้อมูล</h3>
  <table>
    <thead>
      <tr>
        <th id="thDate">วันที่</th>
        <th id="thRain">มม.</th>
      </tr>
    </thead>
    <tbody id="table"></tbody>
  </table>
</div>

<script>
/* ---------- ภาษา ---------- */
const T={
  th:{title:"ปริมาณน้ำฝน จังหวัดขอนแก่น",sub:"ข้อมูลปริมาณน้ำฝนย้อนหลัง",sum:"ฝนรวม",avg:"เฉลี่ย/วัน",max:"มากสุด",table:"ตารางข้อมูล",date:"วันที่"},
  en:{title:"Rainfall in Khon Kaen",sub:"Historical rainfall data",sum:"Total",avg:"Avg/day",max:"Max",table:"Data table",date:"Date"}
};
function setLang(l){
  title.innerText=T[l].title;
  subtitle.innerText=T[l].sub;
  tSum.innerText=T[l].sum;
  tAvg.innerText=T[l].avg;
  tMax.innerText=T[l].max;
  tableTitle.innerText=T[l].table;
  thDate.innerText=T[l].date;
}

/* ---------- สร้างข้อมูลย้อนหลัง 2 ปี (จำลองใกล้เคียงจริง) ---------- */
const ALL=[];
const today=new Date();
for(let i=729;i>=0;i--){
  const d=new Date(today);
  d.setDate(d.getDate()-i);
  const month=d.getMonth()+1;
  let rain=0;
  if(month>=5&&month<=10){
    rain=Math.random()*40;
  }else{
    rain=Math.random()*5;
  }
  ALL.push({date:d.toISOString().slice(0,10),rain:+rain.toFixed(1)});
}

let chart;

/* ---------- render ---------- */
function render(){
  const days=+range.value;
  const mode=document.getElementById("mode").value;
  let data=ALL.slice(-days);

  if(mode==="monthly"){
    const m={};
    data.forEach(d=>{
      const k=d.date.slice(0,7);
      m[k]=(m[k]||0)+d.rain;
    });
    data=Object.entries(m).map(([k,v])=>({date:k,rain:+v.toFixed(1)}));
  }

  sum.innerText=data.reduce((a,b)=>a+b.rain,0).toFixed(1);
  avg.innerText=(data.reduce((a,b)=>a+b.rain,0)/data.length).toFixed(1);
  max.innerText=Math.max(...data.map(d=>d.rain)).toFixed(1);

  if(chart) chart.destroy();
  chart=new Chart(chart=document.getElementById("chart"),{
    type:"bar",
    data:{labels:data.map(d=>d.date),datasets:[{data:data.map(d=>d.rain)}]},
    options:{responsive:true,scales:{y:{beginAtZero:true}}}
  });

  table.innerHTML="";
  data.forEach(d=>{
    table.innerHTML+=`<tr><td>${d.date}</td><td>${d.rain}</td></tr>`;
  });
}

render();
</script>
</body>
</html>
